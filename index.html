<!doctype html>
<html class="no-js" lang="">
    <head>
      <meta charset="utf-8">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      <title></title>
      <meta name="description" content="">
      <meta name="viewport" content="width=device-width, initial-scale=1">

      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
      <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-providers/1.1.15/leaflet-providers.min.js"></script>
      <script src="https://d3js.org/d3.v4.min.js"></script>

      <style>

        body {
          font: 12px sans-serif;
          margin: 0;
          padding: 0;
        }

        html, body{
          height: 98%;
        }

        #map{
          height: 50%;
        }



/*        #map{
          height: 50%;
          width: 100%;
          padding: 0;
          margin: 0;
        }
*/
      </style>

    </head>
    <body>


      <div id="map"></div>

    
      <script type="text/javascript">

        var sthlm = [59.311162, 18.074806];
        var map = L.map('map');
        L.tileLayer.provider('OpenStreetMap.BlackAndWhite').addTo(map);
        map.setView(sthlm, 13);

        var circle = L.circleMarker(sthlm, {
          color: "red",
          fillColor: "red",
          fillOpacity: 0.5,
          radius: 5
        }).addTo(map);

        map.on('click', onMapClick);

        function onMapClick(e){
          // getNewData(e.latlng);

          circle.setLatLng(e.latlng);
          circle.setStyle({
            color: "red",
            fillColor: "red"
          });
        }

        var startDate = "2016-06-01",
            endDate = "2016-06-10";

        getNewData(sthlm[0], sthlm[1], startDate, endDate);

        function getNewData(lat, lng, start, end){

          var url =
            "/darkskySeason?lat=" + lat
            + "&lng=" + lng
            + "&startDate=" + start
            + "&endDate=" + end;

          d3.json(url, function(err, json){
            console.log(json);
          });

        }
	    	
	    </script>
    
    </body>
</html>